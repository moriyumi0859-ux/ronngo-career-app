import streamlit as st
from utils.constants import (set_background, set_main_card_style, set_sidebar_background,set_sidebar_nav_title)

# ==============================
# ページ設定（必ず最初）
# ==============================
st.set_page_config(
    page_title="部下育成コーチ",
    page_icon="👥",
)

# ==============================
# レイアウト共通（背景・カード・サイドバー）
# ==============================
set_background("assets/background/back_view.png")
set_sidebar_background()
set_main_card_style(padding_top=1.2)
set_sidebar_nav_title("メニュー")

HAS_PAGE_LINK = hasattr(st, "page_link")

# ==============================
# シーン別育成データ
# ==============================
SCENES = {
    "任せ方がわからない": {
        "quote": "「己の立たんと欲して、人を立て、己の達せんと欲して、人を達す。」",
        "meaning": "自分が立ちたいならまず人を立て、自分が成功したいならまず人を成功に導きなさい。",
        "advice": (
            "任せるとは、仕事を手放すことではなく、成長の機会を手渡すことです。\n"
            "最初から完璧さを求めるのではなく、いまの力で挑戦できる“少し背伸びの仕事”を選ぶことが大切です。\n"
            "うまくいかなかった点だけでなく、工夫していた点や粘り強さにも光を当てることで、部下は自信を育てていきます。\n"
            "あなたが信じて託した分だけ、相手の中にも『応えたい』という前向きな責任感が芽生えていきます。"
        ),
        "steps": [
            "仕事のゴールと「ここだけは外せないポイント」を最初に共有する。",
            "途中で細かく口出ししすぎず、節目だけ短く状況確認をする。",
            "結果だけでなく、途中の工夫や姿勢を1つ具体的にフィードバックする。",
        ],
    },
    "叱り方が難しい": {
        "quote": "「過ちて改めざる、是を過ちと謂う。」",
        "meaning": "失敗そのものより、改善しないことこそが本当の失敗である。",
        "advice": (
            "叱る目的は、相手を黙らせることではなく、次に同じ失敗を繰り返さない道筋を一緒に探すことです。\n"
            "感情のままに言葉をぶつけてしまうと、相手は『何が悪かったのか』よりも『自分は否定された』と感じてしまいます。\n"
            "事実と影響、そして望ましい行動を落ち着いて伝えることで、叱る時間そのものが学びの場に変わります。\n"
            "最後に『期待しているからこそ伝えている』と添えることで、関係性を傷つけずに成長を促すことができます。"
        ),
        "steps": [
            "その場の感情が強いときは、一呼吸おいてから話す時間をつくる。",
            "人格ではなく「事実」と「行動」にフォーカスして伝える。",
            "改善イメージを一緒に言語化し、『次はこうしよう』で会話を締めくくる。",
        ],
    },
    "成長しない部下への向き合い方": {
        "quote": "「三人行えば、必ず我が師有り。」",
        "meaning": "誰からも学ぶ姿勢があれば、必ず成長するきっかけが得られる。",
        "advice": (
            "『成長していないように見える部下』も、実は気づかれにくいところで少しずつ変化していることがあります。\n"
            "期待とのギャップだけに目を向けると、相手の小さな進歩や努力を見落としてしまい、お互いに苦しくなってしまいます。\n"
            "どこが伸びてきているのか、どこに得意の芽があるのかを一緒に探す視点に切り替えることで、会話のトーンも自然と前向きになります。\n"
            "成長を急がせるのではなく、『今の一歩』に光を当てていくことが、結果として大きな変化につながっていきます。"
        ),
        "steps": [
            "過去と比べて“少しでも良くなっている点”を3つ探して言葉にする。",
            "得意な領域と苦手な領域を一緒に棚卸しし、役割の見直しを検討する。",
            "短期の成果だけでなく、中長期で育てたい力を共有する時間を持つ。",
        ],
    },
    "メンタルが不安定な部下": {
        "quote": "「小不忍、則ち大謀を乱す。」",
        "meaning": "小さな我慢ができないと、大きな計画を壊してしまう。",
        "advice": (
            "メンタルの揺れは、本人の弱さではなく『いまの負荷が大きすぎる』というサインでもあります。\n"
            "頑張り続けてきた結果として限界が来ていることも多く、まずは“責めずに受け止める姿勢”が信頼の土台になります。\n"
            "問題を一気に解決しようとするのではなく、業務・人間関係・環境などを一緒に分解して、手当てできる部分から少しずつ整えていくことが大切です。\n"
            "『支える側のあなたもひとりで抱え込まない』というスタンスを持つことで、チームとして無理のない支え方を設計していけます。"
        ),
        "steps": [
            "まずは評価やアドバイスを置いて、今の気持ちを最後まで聞く時間をとる。",
            "業務量・期限・人間関係など、ストレス源を一緒に洗い出して優先順位をつける。",
            "必要に応じて産業医・人事など専門の窓口とも連携し、支える側も孤立しないようにする。",
        ],
    },
        "部下が指示待ちで、自分から動いてくれない": {
        "quote": "「之を行うに、又たこれを以てせざるか。」",
        "meaning": "良いと分かっていることは、迷わず行動に移すべきだ、という教えです。",
        "advice": (
            "指示待ちになる背景には、『失敗したくない』『どう動けばいいか分からない』という不安が隠れていることが多いものです。\n"
            "まずは仕事の目的や、優先順位、判断してよい範囲を丁寧に共有し、“動いてよい枠”をはっきりさせてあげることが大切です。\n"
            "自分で考えて動いた結果がたとえ完璧でなくても、その『一歩踏み出したこと』を認めていくことで、少しずつ自発性が育っていきます。\n"
            "上司が安心してチャレンジを見守れる空気をつくるほど、部下の側にも『任せてもらえている』という前向きな責任感が生まれてきます。"
        ),
        "steps": [
            "仕事のゴール・期限・優先順位を具体的な言葉で共有する。",
            "自分で判断してよい範囲を事前に伝え、「この枠の中なら自由にやってみて」と任せてみる。",
            "自発的に動いた場面を見つけたら、結果だけでなく『動いたこと』自体を言葉にしてねぎらう。",
        ],
    },

    "フィードバックしても改善が続かない": {
        "quote": "「過ちて改めざる、是を過ちと謂う。」",
        "meaning": "失敗そのものではなく、改めようとしないことこそが本当の過ちだ、という教えです。",
        "advice": (
            "改善が続かないとき、多くの場合『直すポイントが多すぎる』『何をどこまでやればよいか曖昧』になっています。\n"
            "まずは直してほしい点を“一度に一つ”に絞り、具体的な行動レベルにまで落とし込んで伝えることが大切です。\n"
            "定期的に振り返る場をつくり、小さくても続けられた部分を具体的に認めていくことで、『やれば変われる』という実感が育っていきます。\n"
            "上司が“できていないところ探し”ではなく“変わろうとしている姿”に目を向けるほど、部下も改善を前向きな挑戦として受け止めやすくなります。"
        ),
        "steps": [
            "直してほしいポイントを一度に一つに絞り、行動レベルで具体的に伝える。",
            "チェックするタイミングを決め、短い振り返りミーティングを定期的に行う。",
            "少しでも続けられた点・良くなった点を具体的な言葉でフィードバックする。",
        ],
    },
}

# ==============================
# UI
# ==============================
st.title("👥 部下育成コーチ")
st.caption("論語の知恵をベースに、部下・後輩との向き合い方をそっと整えるページです。")

st.markdown("---")

# ▼ 見出し
st.markdown("""
### 🧭 **育成シーンを選んでください**

<style>
div[data-testid="stSelectbox"] > label {
    font-size: 1.1rem !important;
    font-weight: 600 !important;
}
</style>
""", unsafe_allow_html=True)


# ▼ セレクトボックスを前回と同じように“ふわっと浮かせる”
st.markdown(
    """
    <style>
    /* Selectbox 全体をカードっぽくして浮かせる（名言図書館と同じスタイル） */
    .stSelectbox > div > div {
        border: 1.5px solid rgba(0,0,0,0.18) !important;
        border-radius: 8px !important;
        box-shadow: 0 3px 8px rgba(0,0,0,0.12) !important;
        background-color: rgba(255, 255, 255, 0.96) !important;
    }
    .stSelectbox > div:hover > div {
        border-color: rgba(0,0,0,0.32) !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.18) !important;
    }
    </style>
    """,
    unsafe_allow_html=True,
)

selected = st.selectbox("", list(SCENES.keys()))

st.markdown("---")

# ==============================
# 結果表示
# ==============================
scene = SCENES[selected]

st.markdown("### 📖 論語の一節")
st.markdown(f"> {scene['quote']}")
st.caption(scene["meaning"])

st.markdown("### 💡 アドバイスの解釈")
st.write(scene["advice"])

st.markdown("### 🚶‍♀️ 明日からできる小さな一歩")
for step in scene["steps"]:
    st.markdown(f"- {step}")

st.markdown("---")

# 孔子チャットへの導線
if HAS_PAGE_LINK:
    st.page_link(
        "pages/01_孔子と対話.py",
        label="🗣️ 具体的な状況を孔子に相談してみる",
    )
else:
    st.info("左のサイドバーから「孔子と対話する」を開き、今のシーンについて相談してみてください。")
