import streamlit as st
from utils.constants import (set_background, set_main_card_style, set_sidebar_background,set_sidebar_nav_title)
# ==============================
# ページ設定（必ず最初）
# ==============================
st.set_page_config(
    page_title="シーン別ビジネス相談",
    page_icon="🧭",
)

# ==============================
# レイアウト共通（背景・カード・サイドバー）
# ==============================
set_background("assets/background/office.png")
set_sidebar_background()
set_main_card_style(padding_top=1.0)
set_sidebar_nav_title("メニュー")

HAS_PAGE_LINK = hasattr(st, "page_link")

# ==============================
# シーン定義
# ==============================
SCENES = {
    "boss_relation": {
        "label": "上司とうまくいかない・意見が言いづらい",
        "summary": "上司との距離感や、言いたいことが言えないモヤモヤを整理するシーンです。",
        "detail": (
            "上司との関係は、仕事のやりやすさに大きく影響します。"
            "『反論したら嫌われるのでは…』『本音を出したら評価が下がるかも…』と感じ、"
            "自分の意見を飲み込んでしまうこともあるでしょう。"
            "しかし、ただ我慢するだけでは、仕事の質も心の健康も少しずつ削られていきます。"
        ),
        "analects": "「君子は和して同ぜず。小人は同じて和せず。」",
        "reading": "くんしは わして どうぜず。しょうじんは どうじて わせず。",
        "analects_exp": (
            "立派な人は、調和は大切にするが、ただ周囲に合わせて同じ意見でいることはしない。"
            "一方、未熟な人は、表面上は同じ意見であろうとしながら、心からの調和は図らない、という教えです。"
        ),
        "tips": [
            "まずは『反論』ではなく、『確認・質問』から始める。（例：こう解釈したのですが合っていますか？）",
            "上司の前では、意見をすべて飲み込むのではなく、1つだけ“自分の視点”を添えてみる。",
            "評価されるかどうかではなく、『自分はこう考えている』と伝える経験を少しずつ増やしていく。",
        ],
    },
    "subordinate": {
        "label": "部下・後輩が思うように動いてくれない",
        "summary": "育成の難しさや、任せることへの不安をテーマにしたシーンです。",
        "detail": (
            "任せたいのに任せきれない、指示しても動きが鈍い、"
            "こちらの意図が伝わっていない…。部下や後輩との関わりは、"
            "『自分が未熟なのでは』という不安も刺激されやすいテーマです。"
            "完璧な指導者であろうとするほど、息苦しくなってしまうこともあります。"
        ),
        "analects": "「己の立たんと欲して、人を立て、己の達せんと欲して、人を達す。」",
        "reading": "おのれの たたんと ほっして、ひとを たて、おのれの たっせんと ほっして、ひとを たっす。",
        "analects_exp": (
            "自分が立ちたいと思うなら、まず人を立て、自分が成功したいと思うなら、"
            "まず人を成功させなさい、という意味です。"
            "自分の成果と、相手の成長は、本来矛盾しないという視点を示しています。"
        ),
        "tips": [
            "部下に期待している『具体的な行動』を、曖昧な言葉ではなく行動レベルで共有する。",
            "すべてを教えるのではなく、『ここまでは任せる・ここからは一緒に考える』境界線を決める。",
            "結果だけでなく、『過程で工夫していた点』を1つ見つけて言葉にして伝える。",
        ],
    },
    "team": {
        "label": "チームの空気が重い・意見が出ない",
        "summary": "チーム全体の雰囲気や会議の停滞感を扱うシーンです。",
        "detail": (
            "会議で誰も発言しない、何となく重い空気が流れている、"
            "本音を言うと場が白けてしまいそう…。"
            "そんな状況が続くと、チーム全体のエネルギーが下がっていきます。"
            "必ずしもリーダーでなくても、空気を少しだけ変える関わり方はできます。"
        ),
        "analects": "「学びて思わざれば即ち罔し。思いて学ばざれば即ち殆し。」",
        "reading": "まなびて おもわざれば すなわち くらし。おもいて まなばざれば すなわち あやうし。",
        "analects_exp": (
            "学ぶだけで自分の頭で考えなければ、視野が狭くなり、"
            "逆に考えてばかりで新しい学びを取り入れなければ、危うくなってしまう、という意味です。"
        ),
        "tips": [
            "会議でいきなり意見を求めるのではなく、『まずは1人1分メモタイム』を提案してみる。",
            "自分だけでも『こういう視点もあるかもしれません』と、完全でなくてよい意見を出してみる。",
            "沈黙＝悪いこと、ではなく『考えている時間』と捉え直し、余白の時間をあえて許容してみる。",
        ],
    },
    "motivation": {
        "label": "やる気が出ない・モチベーションが続かない",
        "summary": "前向きに取り組みたいのに、心がついてこないときのシーンです。",
        "detail": (
            "仕事に意味を感じられない、成果が見えず手応えがない、"
            "頑張るほど空回りしているように感じる…。"
            "そんなとき、『気合い』だけで何とかしようとすると、かえって消耗してしまいます。"
        ),
        "analects": "「之を知る者は之を好む者に如かず。之を好む者は之を楽しむ者に如かず。」",
        "reading": "これを しるものは これを このむものに しかず。これを このむものは これを たのしむものに しかず。",
        "analects_exp": (
            "ただ知っている人より、それを好きな人が勝り、"
            "さらにそれを楽しんでいる人にはかなわない、という教えです。"
        ),
        "tips": [
            "『全体の仕事』ではなく、『今日の中でちょっとだけ楽しめそうな1ポイント』を探してみる。",
            "やる気が出ない自分を責めるのではなく、『今は充電期間なんだな』と少し俯瞰して眺めてみる。",
            "1日の終わりに、『小さな前進』を3つだけ箇条書きにしてみる。",
        ],
    },
    "career": {
        "label": "このままのキャリアで良いのか不安",
        "summary": "将来の方向性や、今の仕事との距離感に悩むシーンです。",
        "detail": (
            "今の仕事を続けるべきか、転職すべきか、専門性を深めるべきか…"
            "キャリアの悩みは、一度考え始めるときりがありません。"
            "焦りだけが募り、具体的な一歩が見えづらくなることもあります。"
        ),
        "analects": "「君子は器ならず。」",
        "reading": "くんしは うつわ ならず。",
        "analects_exp": (
            "立派な人は、単なる道具や器のように、決められた役割にだけ収まる存在ではない、という意味です。"
            "役割や職種を超えて、自分なりのあり方を育てていくことをすすめる言葉です。"
        ),
        "tips": [
            "『やりたいこと』を探す前に、『これだけは嫌・避けたい』を3つ書き出してみる。",
            "いきなり大きく変えようとせず、今の仕事の中で『少しだけ違う役割』に手を伸ばしてみる。",
            "1〜2年単位ではなく、『5年後の自分が喜ぶであろう今の行動』を1つ決めてみる。",
        ],
    },
    "mental": {
        "label": "気持ちがしんどい・自信が持てない",
        "summary": "心が重いときや、自分を責めがちなときに向き合うシーンです。",
        "detail": (
            "うまくいかないことが続くと、『自分には価値がないのでは』と感じてしまうことがあります。"
            "他人と比べ、できていないところばかりに目が向いてしまうのは自然なことです。"
            "しかし、心がすり減りきってしまう前に、立ち止まって自分のペースを取り戻すことが大切です。"
        ),
        "analects": "「過ちて改めざる、是を過ちと謂う。」",
        "reading": "あやまちて あらためざる、これを あやまち と いう。",
        "analects_exp": (
            "失敗そのものではなく、改めようとしないことこそが本当の過ちである、という教えです。"
            "『失敗した自分』を責めるより、『ここから何を学び直せるか』に目を向ける視点を示しています。"
        ),
        "tips": [
            "今日1日を振り返り、『できなかったこと』ではなく『ちゃんとやれた小さなこと』を3つ書き出す。",
            "しんどいときは、未来の大きな不安ではなく、『今の10分をどう穏やかに過ごすか』に意識を向ける。",
            "信頼できる人に、『うまく話せなくてもいいから、今の気持ちだけ聞いてほしい』と伝えてみる。",
        ],
    },
}

# ==============================
# UI 本体
# ==============================
st.title("🧭 シーン別ビジネス相談")
st.caption("よくある“仕事のシーン”ごとに、論語のことばと現代的なヒントをまとめました。")

st.markdown(
    """
    日々の仕事の中で、こんな場面はありませんか？

    - 上司・部下・同僚との関係にモヤモヤする  
    - チームの空気が重い、会議がうまく回らない  
    - やる気が出ない、将来が不安になる  
    - 自分を責めがちで、心が疲れてしまう  

    ここでは、**シーン（状況）を選ぶだけ**で、  
    論語の一節と、そこからのビジネスヒントを受け取ることができます。
    """
)

st.markdown("---")

# ▼ シーン選択のセレクトボックスを、カードっぽく浮かせるCSS
st.markdown("""
<style>
/* Selectbox 全体をカードっぽくして浮かせる */
.stSelectbox > div > div {
    border: 1.5px solid rgba(0,0,0,0.18) !important;
    border-radius: 8px !important;
    box-shadow: 0 3px 8px rgba(0,0,0,0.12) !important;
    background-color: rgba(255, 255, 255, 0.96) !important;  /* 白カード感を少し強める */
}

/* ホバー時にふんわり強調 */
.stSelectbox > div:hover > div {
    border-color: rgba(0,0,0,0.32) !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.18) !important;
}
</style>
""", unsafe_allow_html=True)

# シーン選択
scene_labels = [info["label"] for info in SCENES.values()]
label_to_key = {info["label"]: key for key, info in SCENES.items()}

st.markdown("## 🔍 シーンを選んでください")
selected_label = st.selectbox("▼ いま気になっている状況", scene_labels)
selected_scene = SCENES[label_to_key[selected_label]]

st.markdown("---")

# 選択されたシーンの内容表示
st.markdown(f"### 😞 シーン：{selected_scene['label']}")
st.write(f"**概要**：{selected_scene['summary']}")
st.write(selected_scene["detail"])

st.markdown("### 📖 関連する論語の一節")
st.markdown(f"> {selected_scene['analects']}")
st.caption(f"【読み】{selected_scene['reading']}")
st.caption(selected_scene["analects_exp"])

st.markdown("### 🚶‍♀️ こんな一歩から始めてみませんか？")
for tip in selected_scene["tips"]:
    st.markdown(f"- {tip}")

st.markdown("---")

# 孔子チャットへの導線
st.markdown("#### 🗣️ もっと具体的な状況を相談したい場合は…")

if HAS_PAGE_LINK:
    st.page_link("pages/01_孔子と対話.py", label="孔子にこのシーンについて相談してみる", icon="🗣️")
else:
    st.info("左のサイドバーから「孔子と対話する」のページを開き、今のシーンについて具体的に相談してみましょう。")
